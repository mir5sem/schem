# 14. Процессорные системы класса Soft-процессоры
Soft-процессор — это программируемое ядро процессора, которое реализуется в программируемой логической интегральной схеме (FPGA) или подобной архитектуре. В отличие от традиционных процессоров, которые изготавливаются в виде фиксированных аппаратных чипов (hard-процессоры), soft-процессоры представляют собой виртуальную модель, загружаемую и выполняемую на программируемой логике.

Soft-процессор не существует физически как отдельный чип; он создаётся в FPGA с помощью описания на языке аппаратного проектирования (например, VHDL или Verilog).

 Особенностью проектирования структуры СнК стало повторное использование готовых IP блоков, которые делятся на две группы:
- Аппаратные или hard IP – физически встраиваемые топологические фрагменты на кристалле.
- Синтезируемые soft IP – логические элементы в виде описания, которые встраивают при помощи САПР.

Они относятся к разным способам реализации процессора внутри FPGA.
- **Hard процессор** — это физически реализованный процессор, который уже встроен в кристалл ПЛИС. Это значит, что процессор представляет собой фиксированную, неизменяемую структуру на чипе, как, например, ARM Cortex-A9, встроенный в некоторые FPGA от Xilinx или Altera (Intel).
- **Soft процессор** — это процессор, реализованный в виде синтезируемого описания на HDL (Hardware Description Language), таком как Verilog или VHDL. Этот процессор не является физической частью FPGA с самого начала и может быть сконфигурирован пользователем.

Soft-процессоры – это процессоры, которые описаны на языке описания аппаратуры (HDL) и могут быть загружены в программируемые логические устройства, такие как FPGA (Field-Programmable Gate Array). Они обычно используются для конкретных задач в проектах встроенных систем. Вот некоторые типы soft-процессоров:

1. **Процессоры общего назначения:**
	- **MicroBlaze:** 32-битный soft-процессор от Xilinx, совместимый с архитектурой RISC.
	- **Nios II:** 32-битный процессор от Intel (ранее Altera), также построенный на архитектуре RISC.
	- **LEON:** 32-битный процессор на основе архитектуры SPARC, разработанный ESA.
	- **LatticeMico32:** Бесплатный 32-битный процессор от Lattice Semiconductor.
	- **RISC-V:** Открытая архитектура, доступны различные реализации soft-процессоров.
2. **Процессоры с малым энергопотреблением:**
	- **PicoBlaze:** 8-битный процессор от Xilinx, предназначенный для маломощных задач.
	- **LatticeMico8:** Бесплатный 8-битный процессор от Lattice Semiconductor.
3. **Специализированные процессоры:**
	- **OR1200 (OpenRISC):** Открытый soft-процессор с 32-битной архитектурой.
	- **ZPU:** Процессор с минимизированной архитектурой (stack-based).
4. **DSP-процессоры (Digital Signal Processing):**
	- **Xilinx DSP48E:** Специализированный процессор для цифровой обработки сигналов.
	- **NIOS II/f:** Версия Nios II с оптимизацией для цифровой обработки сигналов.
5. **Системы на кристалле (SoC):**
	- **Zynq-7000:** Комбинирует ARM Cortex-A9 с программируемой логикой FPGA.
	- **Cyclone V SoC:** Сочетает ARM Cortex-A9 с логикой FPGA.
6. **Процессоры с открытым исходным кодом:**
	- **Rocket:** 64-битный RISC-V процессор от Berkeley.
	- **VexRiscv:** Высокооптимизированный и настраиваемый RISC-V процессор.
	- **PicoRV32:** Компактный 32-битный RISC-V процессор.
7. **Старые/классические процессоры:**
	- **T80:** Реализация Zilog Z80.
	- **T65:** Реализация MOS 6502.
	- **AO68000:** Реализация Motorola 68000.
## Ключевые отличия soft-процессоров и hard-процессоров

**Hard-процессоры и Soft-процессоры** — это два различных подхода к интеграции процессорных ядер с программируемой логикой (ПЛИС).

**Hard-процессоры** — это физические процессорные ядра, которые интегрированы на кристалл вместе с ПЛИС.
- **Физическое размещение на кристалле**: Hard-процессоры размещены на том же кристалле, что и ПЛИС, но являются отдельными физическими блоками.
- **Фиксированная архитектура**: Архитектура этих процессоров задана на этапе производства и не подлежит изменению пользователем. Это означает, что пользователь не может изменить внутреннее устройство или параметры процессорного ядра. 
- **Зависимость от PDK (Process Design Kit)**: Производительность и другие характеристики hard-процессора зависят от ограничений, накладываемых технологическим процессом, который определяется процессорными наборами проектирования (PDK). Эти киты включают правила проектирования, модели транзисторов, параметры металлизации и другие технологические аспекты, которые влияют на скорость, потребление энергии и другие важные параметры процессора.
- **Примеры hard-процессоров**: В мире ПЛИС популярными примерами hard-процессоров являются ARM Cortex-A9, используемый в Xilinx Zynq-7000, или ARM Cortex-A53 в Xilinx Zynq UltraScale+ MPSoC.
- **Преимущества**: Основные преимущества включают более высокую производительность по сравнению с soft-процессорами, меньшее потребление энергии и более предсказуемые временные характеристики, поскольку архитектура оптимизирована и зафиксирована на аппаратном уровне.
- **Недостатки**: Основной недостаток — низкая гибкость. Пользователи не могут модифицировать процессор для специфических нужд своих приложений. Также, обновление или изменение функциональности требует замены всего кристалла.

**Soft-процессоры** — это процессорные ядра, которые реализуются на аппаратных ресурсах ПЛИС.
- **Размещение на аппаратных ресурсах ПЛИС**: Soft-процессоры не являются физическими блоками на кристалле. Вместо этого, они реализуются как конфигурируемая логика внутри самой ПЛИС, используя доступные логические блоки, регистры и интерконнекты.
- **Изменяемая архитектура**: Пользователи могут изменять архитектуру soft-процессоров, адаптируя их под конкретные требования задачи. Это включает изменение размера регистров, исполнительных блоков, а также добавление или удаление определённых инструкций.
- **Зависимость от аппаратных ресурсов ПЛИС**: Производительность soft-процессора напрямую зависит от количества использованных логических элементов ПЛИС, скорости их работы и эффективности интерконнектов. Это означает, что производительность может варьироваться в зависимости от того, как процессор был реализован внутри ПЛИС.
- **Примеры soft-процессоров**: Примеры включают Xilinx MicroBlaze и Altera (Intel) Nios II.
- **Преимущества**: Главное преимущество — высокая гибкость и возможность адаптации под конкретные нужды. Soft-процессоры позволяют пользователю оптимизировать архитектуру под задачи, что может включать специфические инструкции, оптимизированные пути выполнения и поддержку различных периферийных устройств.
- **Недостатки**: Основной недостаток — ниже производительность по сравнению с hard-процессорами из-за накладных расходов на реализацию в программируемой логике. Также, soft-процессоры потребляют больше ресурсов ПЛИС и могут быть менее энергоэффективными.

| Параметр              | Hard-процессоры     | Soft-процессоры                   |
| --------------------- | ------------------- | --------------------------------- |
| Физическая интеграция | На кристалле с ПЛИС | В логике ПЛИС                     |
| Архитектура           | Фиксирована         | Конфигурируема                    |
| Зависимость           | От PDK              | От ресурсов ПЛИС                  |
| Производительность    | Высокая             | Ниже, зависит от реализации       |
| Гибкость              | Низкая              | Высокая                           |
| Примеры               | ARM Cortex-A9, A53  | Xilinx MicroBlaze, Altera Nios II |

Soft-процессоры предоставляют уникальную возможность для специализированной адаптации, в то время как hard-процессоры предлагают оптимизированную производительность и эффективность для стандартных задач.
## Soft-процессоры
##### 1. Altera (Intel)
Altera, после поглощения компанией Intel, продолжила разработку и поддержку soft-процессоров в своих ПЛИС. Основные семейства:
- **Nios II**: Это наиболее известный и широко используемый soft-процессор от Altera (Intel). Nios II предлагает три различных конфигурации:
  - **Nios II/f (fast)**: Оптимизирован для высокой производительности с поддержкой кэш-памяти и более сложных функций.
  - **Nios II/e (economy)**: Это более простая и экономичная версия, предназначенная для минимизации использования ресурсов ПЛИС.
  - **Nios II/s (standard)**: Средний вариант, предлагающий хороший баланс между производительностью и затратами ресурсов.
##### 2. AMD
AMD не является основным игроком на рынке ПЛИС и soft-процессоров напрямую, но через приобретение Xilinx они получили доступ к технологиям ПЛИС и соответствующим разработкам. Однако, рассматривая их в контексте ПЛИС и soft-процессоров:
- **MicroBlaze**: Это soft-процессор от Xilinx (теперь под крылом AMD после поглощения). MicroBlaze является очень гибким и конфигурируемым процессором, который может быть адаптирован под различные задачи.
##### 3. Lattice Semiconductor
- **Mico8**: Это очень легкий 8-битный микроконтроллерный soft-процессор, оптимизированный для использования в ПЛИС Lattice.
- **Mico32**: 32-битный soft-процессор, который предоставляет более высокую производительность по сравнению с Mico8 и поддерживает более широкий диапазон операций.
##### 4. OpenRISC
- **OpenRISC 1000**: Это основная архитектура, предоставляющая 32-битные или 64-битные RISC процессоры. OpenRISC 1200 — наиболее популярная реализация этой архитектуры, предлагающая открытую и модульную структуру для различных применений.

| Параметр / Процессор | Nios II                        | MicroBlaze                | Mico8                       | Mico32                                 | OpenRISC 1200                                   |
| -------------------- | ------------------------------ | ------------------------- | --------------------------- | -------------------------------------- | ----------------------------------------------- |
| Архитектура          | 16/32-бит RISC                 | 32-бит RISC               | 8-бит                       | 32-бит                                 | 32/64-бит RISC                                  |
| Конфигурации         | f, e, s                        | Конфигурируемый           | Легкий                      | Более мощный                           | Конфигурируемый                                 |
| Особенности          | Поддержка кэша в f-версии, DMA | Поддержка кэша, MMU       | Простота, минимум ресурсов  | Баланс между размером и скоростью      | Поддержка MMU, открытая архитектура             |
| Применение           | Встраиваемые системы, IoT      | Встраиваемые системы, DSP | Простые управляющие системы | Встраиваемые системы средней сложности | Системы с открытым исходным кодом, исследования |

Выбор между этими soft-процессорами зависит от конкретных требований проекта, включая необходимую производительность, доступные ресурсы ПЛИС, стоимость и требования к гибкости разработки. OpenRISC и RISC-V (через PicoRV32 и VexRiscv) предлагают высокую степень модификации и открытые архитектуры, что делает их предпочтительными для образовательных проектов и разработки с открытым исходным кодом.

### 1. Nios II (Altera/Intel)
**Nios II** — это очень гибкий soft-процессор от компании Intel (ранее Altera). Он предназначен для использования в ПЛИС и может быть настроен под конкретные нужды проекта.
- **Простота использования**: Nios II легко интегрируется с другими компонентами на кристалле ПЛИС, что делает его удобным для разработчиков, не желающих углубляться в сложности аппаратного проектирования.
- **Три версии**: 
  - **f (fast)**: Быстрая версия, подходит для задач, требующих высокой производительности.
  - **e (economy)**: Экономичная версия, использует меньше ресурсов ПЛИС, подходит для простых задач.
  - **s (standard)**: Стандартная версия, баланс между скоростью и ресурсами.
- **Широкое применение**: Подходит для различных встраиваемых систем, от простых устройств управления до более сложных систем с интерфейсами и обработкой данных.

### 2. MicroBlaze (AMD через Xilinx)
**MicroBlaze** — это soft-процессор от Xilinx, который теперь под крылом AMD. Он широко используется для создания настраиваемых вычислительных систем внутри ПЛИС.

- **Высокая настраиваемость**: Можно изменять множество параметров процессора, включая размер кэша, архитектуру памяти и поддерживаемые инструкции.
- **Поддержка сложных систем**: MicroBlaze хорошо подходит для создания комплексных встраиваемых систем с поддержкой операционных систем, таких как Linux.
- **Производительность и ресурсы**: Обеспечивает хорошую производительность, но может потреблять значительное количество ресурсов ПЛИС в зависимости от конфигурации.

### 3. Mico8/Mico32 (Lattice Semiconductor)
**Mico8** и **Mico32** — это soft-процессоры от Lattice Semiconductor, предназначенные для использования в их ПЛИС.

- **Mico8**:
  - **Простота**: 8-битный процессор, очень легкий и потребляет минимум ресурсов.
  - **Ограниченная функциональность**: Подходит для очень простых задач, таких как базовое управление или простая обработка сигналов.
- **Mico32**:
  - **Больше возможностей**: 32-битный процессор, предлагает лучшую производительность и поддержку более сложных операций.
  - **Сбалансированное использование ресурсов**: Использует больше ресурсов, чем Mico8, но меньше, чем более крупные soft-процессоры, подходит для средней сложности задач.

### 4. OpenRISC 1200
**OpenRISC 1200** — это процессор с открытым исходным кодом, представляющий семейство OpenRISC.

- **Открытая архитектура**: Его можно модифицировать и адаптировать под любые нужды, что делает его популярным в образовательных и исследовательских проектах.
- **Поддержка различных операций**: 32 или 64-битные варианты, поддержка сложных инструкций и возможность работы с операционными системами, включая Linux.
- **Сообщество и поддержка**: Благодаря открытому исходному коду, имеет широкое сообщество и множество ресурсов для обучения и поддержки.

Сравнение в простых терминах
- **Nios II**: Если вам нужен универсальный, легко настраиваемый процессор, который можно быстро адаптировать под разные задачи.
- **MicroBlaze**: Лучший выбор для создания сложных систем с возможностью запуска операционных систем; потребляет больше ресурсов, но предлагает высокую производительность.
- **Mico8/Mico32**: Идеальны для простых или средней сложности задач в ПЛИС от Lattice, когда нужно сохранить ресурсы.
- **OpenRISC 1200**: Отличный выбор для тех, кто хочет полную свободу в адаптации и модификации процессора, отлично подходит для образовательных проектов и исследований.

Выбор soft-процессора зависит от требований вашего проекта, включая необходимую производительность, гибкость в настройке, доступные ресурсы ПЛИС и желаемый уровень сложности в разработке.
## Intel/Altera Nios (2001): характеристики, особенности
Nios — это микропроцессорная архитектура, разработанная компанией Intel (ранее Altera), предназначенная для использования в программируемых логических интегральных схемах (ПЛИС) или FPGA (Field-Programmable Gate Array).

1. **Конвейерная RISC-архитектура**
   - **Четыре стадии конвейера:**
     - **Fetch:** выборка команды из памяти.
     - **Decode / Operand Fetch:** декодирование команды и выборка операндов.
     - **Execute:** выполнение операции.
     - **Write-back:** запись результата в регистр.
   - Большинство инструкций выполняется за один такт процессора.
2. **Размер машинного слова**
   - 16 бит (half-word), потребление ресурсов порядка 1100 логических ячеек.
   - 32 бита (word), потребление ресурсов порядка 1700 логических ячеек.
3. **Статическая конфигурация**
   - Набор команд фиксирован и не может быть изменён или расширен после проектирования.
4. **Вычислительные возможности**
   - Процессор имеет ограниченные вычислительные возможности, характерные для простых RISC-ядер.
   - В стандартном наборе команд отсутствует целочисленное деление; оно может быть реализовано через псевдо-инструкции.
   - Операции с вещественными числами отсутствуют; требуются программные реализации или специализированные аппаратные блоки.
5. **Обработка прерываний**
   - Присутствует механизм обработки прерываний, что позволяет реагировать на внешние и внутренние события в реальном времени.

Дополнительно:
- **Модульность:** Ядро Nios может быть настроено с различными опциями для разных задач, включая выбор набора инструкций, размера регистров и наличия дополнительных интерфейсов.
- **Встраиваемость:** Ядро процессора может быть интегрировано с другими блоками FPGA, такими как пользовательские IP-ядра, аппаратные множители, делители и другие компоненты.
- **Отладка:** Поддерживается возможность отладки программного обеспечения с использованием JTAG и других технологий.
- **Средства разработки:** Используется среда разработки от Intel (ранее Altera) Quartus II, а также Nios II Embedded Design Suite (EDS), включающая компиляторы, отладчики и другие инструменты.

### Архитектура Nios
![700](../attachments/Pasted%20image%2020241215171338.png)

**Входы:**
*   **data in (32):** Входные данные (32-битная шина).
*   **wait:** Сигнал ожидания.
*   **irq, irq# (6):** Сигналы запроса прерывания и номер прерывания (6 линий).
*   **reset:** Сигнал сброса.
*   **clock:** Тактовый сигнал.

**Выходы:**
*   **data out (32):** Выходные данные (32-битная шина).
*   **address (32):** Адрес (32-битная шина).
*   **read/write:** Сигнал чтения/записи.
*   **ifetch:** Сигнал выборки инструкции.
*   **byte enable (4):** Сигналы разрешения записи по байтам (4 линии, для 32-битной шины).

**Внутренние блоки:**
*   **D (32):** Входной регистр данных (32-битный).
*   **Instruction Decoder:** Декодер инструкций. Интерпретирует код инструкции и генерирует управляющие сигналы для других блоков.
*   **Clock Enable:** Схема разрешения тактирования. Управляет подачей тактового сигнала на различные блоки.
*   **Operand Fetch:** Блок выборки операндов. Извлекает операнды, необходимые для выполнения инструкции.
*   **Program Counter (PC):** Счетчик команд. Хранит адрес следующей инструкции, подлежащей выполнению.
*   **ALU (Arithmetic Logic Unit):** Арифметико-логическое устройство. Выполняет арифметические и логические операции над данными.
*   **Q (32):** Два выходных регистра (32-битные). Один используется для данных, другой - для адреса.
*   **Interrupt Control:** Контроллер прерываний. Обрабатывает запросы прерываний.
*   **General-Purpose Processor Register File:** Регистровый файл общего назначения. Набор регистров, используемых для хранения данных и промежуточных результатов.
*   **Control:** Блок управления. Генерирует управляющие сигналы на основе сигналов от декодера инструкций, контроллера прерываний и других блоков.

**Принцип работы:**
1. **Выборка инструкции:** Счетчик команд (PC) указывает адрес следующей инструкции. Инструкция считывается из памяти (не показана на диаграмме) и поступает в декодер инструкций.
2. **Декодирование инструкции:** Декодер инструкций определяет тип операции и необходимые операнды.
3. **Выборка операндов:** Блок выборки операндов извлекает данные из регистрового файла или из памяти (через вход "data in").
4. **Выполнение операции:** АЛУ выполняет операцию, указанную в инструкции, над выбранными операндами.
5. **Запись результата:** Результат операции записывается в регистровый файл или в память (через выход "data out").
6. **Обновление счетчика команд:** Счетчик команд обновляется, указывая на следующую инструкцию.
7. **Обработка прерываний:** При поступлении запроса прерывания контроллер прерываний может приостановить выполнение текущей программы и передать управление обработчику прерывания.

**Ключевые особенности:**
*   **Простая архитектура:** Диаграмма отражает базовую архитектуру процессора, без усложнений вроде кэширования или конвейеризации.
*   **Раздельные шины данных и адреса:** Процессор использует отдельные шины для данных и адреса.
*   **Синхронный дизайн:** Все операции выполняются синхронно с тактовым сигналом.
## Intel/Altera Nios II (2004): характеристики, особенности
Intel/Altera Nios II является вторым поколением микропроцессорных ядер, разработанных для использования в программируемых логических интегральных схемах (ПЛИС) от Intel (ранее Altera). Это улучшенная версия семейства Nios, представленная в 2004 году, и она предлагает большую гибкость, улучшенные вычислительные возможности и оптимизированную архитектуру.

Характеристики Fast версии:
1. **Три версии ядра:**
   - **Fast:** Ориентирована на высокую производительность (1800 логических ячеек без MMU, 3200 логических ячеек с MMU).
   - **Standard:** Сбалансированный вариант (1200 логических ячеек).
   - **Economy:** Экономичный вариант для менее требовательных приложений (600 логических ячеек).
2. **Основные характеристики (Fast версия):**
   - **Архитектура:** 32-битные команды и 32-битные данные, RISC архитектура.
   - **Стадии выполнения команды:** 6 стадий:
     - **FETCH:** Выборка инструкции.
     - **DECODE:** Декодирование инструкции.
     - **EXECUTE:** Исполнение инструкции.
     - **MEMORY:** Обращение к памяти.
     - **ALIGN:** Выравнивание адреса в памяти.
     - **WRITEBACK:** Запись результата в память.
   - **Аппаратная реализация:** Поддержка операций умножения и деления на аппаратном уровне.
   - **Поддержка длинных чисел:** Операции с 64-битными и 128-битными целыми числами.
   - **Поддержка чисел с плавающей точкой:** Реализация стандарта IEEE 754 для чисел одинарной и двойной точности.
   - **Кэш-память:** 64 КБ для инструкций и 64 КБ для данных.
   - **Адресное пространство:** До 2 ГБ.
   - **Прерывания:** Внешний контроллер прерываний с поддержкой до 32 источников.
3. **Особенности и возможности конфигурации:**
   - **Конфигурация собственных инструкций:** Возможность добавления пользовательских инструкций для специализированных задач.
   - **Конфигурация собственной периферии:** Можно интегрировать собственные периферийные устройства через системный интерконнект.
   - **Модульная система:** Позволяет выбирать компоненты ядра для оптимизации использования ресурсов ПЛИС.
   - **Отладка и разработка:** Поддерживается среда разработки Intel Quartus и Nios II Software Build Tools для эффективной разработки и отладки.

### Архитектура процессора Nios II

![600](../attachments/Pasted%20image%2020241215171045.png)

**Входы и интерфейсы:**
*   **reset clock, cpu_resetrequest, cpu_resettaken:** Входы для сигналов сброса и тактирования.
*   **JTAG interface to software debugger:** Интерфейс JTAG для подключения отладчика. Позволяет выполнять пошаговую отладку, просматривать и изменять состояние процессора.
*   **irq\[31..0]:** Входы для сигналов аппаратных прерываний (всего 32 линии).
*   **eic_port_data\[44..0], eic_port_valid:** Интерфейс для подключения внешнего контроллера прерываний (External Interrupt Controller - EIC).
*   **Custom I/O Signals:** Сигналы для взаимодействия с пользовательской логикой.

**Основные блоки (обязательные - синие, опциональные - светло-серые):**
*   **Program Controller & Address Generation:** Блок управления программой и генерации адреса. Отвечает за выборку инструкций из памяти и управление потоком выполнения.
*   **JTAG Debug Module:** Модуль отладки JTAG. Обеспечивает интерфейс для отладки и программирования процессора.
*   **Exception Controller:** Обрабатывает исключительные ситуации (ошибки, деление на ноль и т.д.).
*   **Internal Interrupt Controller:** Внутренний контроллер прерываний, обрабатывающий прерывания от irq\[31..0].
*   **External Interrupt Controller Interface:** Интерфейс для взаимодействия с внешним контроллером прерываний.
*   **Custom Instruction Logic:** Логика для реализации пользовательских инструкций, расширяющих базовую систему команд.
*   **General Purpose Registers:** Регистры общего назначения, используемые для хранения данных и промежуточных результатов вычислений.
*   **Control Registers:** Регистры управления, используемые для настройки и контроля работы процессора.
*   **Shadow Register Sets (опционально):** Теневые наборы регистров, используемые для быстрого переключения контекста, например, при обработке прерываний.
*   **Instruction Regions, Memory Protection Unit, Data Regions (опционально):**  Средства для защиты памяти, позволяющие определить регионы с разными правами доступа.
*   **Memory Management Unit (MMU) (опционально):** Блок управления памятью, отвечающий за трансляцию виртуальных адресов в физические.
*   **Translation Lookaside Buffer (TLB) (опционально):** Буфер ассоциативной трансляции, кэширующий результаты трансляции адресов для ускорения доступа к памяти.
*   **Arithmetic Logic Unit (ALU):** Арифметико-логическое устройство, выполняющее арифметические и логические операции.
*   **Instruction Cache (опционально):** Кэш инструкций для ускорения выборки инструкций.
*   **Data Cache (опционально):** Кэш данных для ускорения доступа к данным.
## Intel/Altera Nios V (2021): характеристики, особенности
Intel/Altera Nios V является значительным обновлением в семействе микропроцессоров Nios, внося в него поддержку современной архитектуры RISC-V.

Nios V представлен в трёх версиях: General Purpose, Microcontroller и Compact.

1. **Переход на архитектуру RISC-V:**
   - **Архитектура RISC V:** Nios V базируется на открытой архитектуре RISC-V, что делает его более гибким и совместимым с рядом стандартных инструментов и библиотек. Эта архитектура поддерживает модульное расширение инструкций, что позволяет пользователям добавлять специализированные инструкции в зависимости от нужд проекта.
2. **Конвейер с 5 стадиями:**
   - **5 стадий исполнения команды:** По сравнению с Nios II, где было 6 стадий, Nios V использует 5 стадий конвейера, что помогает уменьшить задержки и улучшить частоту работы:
     - **FETCH (Выборка):** Загрузка инструкции из памяти.
     - **DECODE (Дешифрация):** Определение операции и регистров, участвующих в исполнении.
     - **EXECUTE (Исполнение):** Выполнение арифметических или логических операций.
     - **MEMORY (Обращение к памяти):** Доступ к памяти для загрузки или сохранения данных.
     - **WRITEBACK (Запись в память):** Возвращение результата операции в регистр процессора.

3. **Поддержка системной шины AXI4-Lite:**
   - **AXI4-Lite Memory Mapped:** Nios V поддерживает шину AXI4-Lite для доступа к памяти. Это универсальная шина, разработанная ARM, обеспечивающая высокую скорость передачи данных и эффективное взаимодействие между различными компонентами системы на кристалле (SoC).

Дополнительно:
- **Поддержка разных типов памяти:** Nios V может работать с разнообразными типами памяти, включая SRAM, DRAM и флэш-память, благодаря гибкой системе настройки шины.

Версии:
**1. Compact (Компактный):** Эта версия предназначена для приложений с ограниченными ресурсами, где важны размер и энергопотребление.
*   **32-bit processor (32-битный процессор):**  Это ядро процессора, отвечающее за выполнение инструкций. В данном случае оно 32-битное, что означает, что оно может обрабатывать 32 бита данных за такт.
*   **Arithmetic logic unit (Арифметико-логическое устройство - АЛУ):**  Выполняет основные арифметические (сложение, вычитание, умножение, деление) и логические (И, ИЛИ, НЕ) операции над данными.
*   **ECC (Error Correction Code - Код коррекции ошибок):**  Механизм, который обнаруживает и исправляет ошибки в памяти, повышая надежность системы.
**2. Microcontroller (Микроконтроллер):** Эта версия подходит для приложений, требующих обработки событий в реальном времени и взаимодействия с периферийными устройствами.
*   **Interrupt controller (Контроллер прерываний):**  Обрабатывает аппаратные прерывания от различных периферийных устройств. Прерывания позволяют процессору реагировать на внешние события асинхронно, без необходимости постоянно опрашивать устройства.
*   **Exception controller (Контроллер исключений):**  Обрабатывает исключительные ситуации, возникающие во время выполнения программы, такие как деление на ноль, ошибки памяти или неверные инструкции.
*   **Timer (Таймер):**  Генерирует временные интервалы или подсчитывает события. Используется для задач, связанных с синхронизацией и управлением по времени.
*   **JTAG debug module (Модуль отладки JTAG):**  Обеспечивает интерфейс для отладки и программирования процессора через стандартный порт JTAG. Позволяет пошагово выполнять программу, просматривать содержимое регистров и памяти, устанавливать точки останова.
**3. General Purpose (Общего назначения):** Эта версия предназначена для высокопроизводительных приложений, требующих сложных математических вычислений и эффективного управления памятью.
*   **Integer Mul/Div (Целочисленный умножитель/делитель):**  Аппаратный блок, ускоряющий операции целочисленного умножения и деления.
*   **Floating point unit (Блок операций с плавающей запятой - FPU):**  Аппаратный блок, выполняющий операции над числами с плавающей запятой, что значительно ускоряет математические вычисления.
*   **Custom instruction (Пользовательские инструкции):**  Возможность расширения системы команд процессора собственными инструкциями, оптимизированными для конкретных задач.
*   **I-cache (Кэш инструкций):**  Небольшая высокоскоростная память, хранящая наиболее часто используемые инструкции. Кэш инструкций уменьшает время доступа к инструкциям, ускоряя выполнение программы.
*   **D-cache (Кэш данных):**  Аналогично I-cache, но хранит наиболее часто используемые данные.
*   **TCM (Tightly Coupled Memory - Тесно связанная память):**  Высокоскоростная память с низкими задержками, обычно используемая для критически важных по времени данных или инструкций.
### Структура Nios® V/g (General Purpose)

![](../attachments/Pasted%20image%2020241215170803.png)

**Входы и интерфейсы:**
*   **Reset Clock:** Вход для сигнала сброса и тактирования.
*   **JTAG Interface to Software Debugger:** Интерфейс JTAG для подключения отладчика, позволяющий пошагово выполнять программу, просматривать и изменять состояние процессора.
*   **irq\[15...0]:** Входы для сигналов аппаратных прерываний от внешних устройств (всего 16 линий).
*   **ECC Interface:** Интерфейс для взаимодействия с внешним модулем ECC (если он не интегрирован в процессор).
*   **Custom Instruction Interface:** Интерфейс для подключения логики пользовательских инструкций.

**Основные блоки (обязательные - синие, опциональные - светло-голубые):**
*   **Program Controller and Address Generation:** Блок управления программой и генерации адреса. Отвечает за выборку инструкций из памяти и управление потоком выполнения.
*   **RISV-V Based Debug Module Agent:** Агент отладочного модуля, совместимого со стандартом RISC-V. Обрабатывает запросы отладчика и предоставляет доступ к внутренним ресурсам процессора.
*   **Exception Controller (опционально):** Обрабатывает исключительные ситуации (ошибки, деление на ноль и т.д.).
*   **Interrupt Controller (опционально):** Управляет аппаратными прерываниями.
*   **ECC Module (опционально):** Модуль для обнаружения и исправления ошибок в памяти.
*   **General Purpose Registers:** Регистры общего назначения, используемые для хранения данных и промежуточных результатов вычислений.
*   **Control & Status Registers:** Регистры управления и состояния, используемые для настройки и контроля работы процессора.
*   **Load-Store Unit:** Блок загрузки и сохранения данных. Отвечает за перемещение данных между регистрами и памятью.
*   **Instruction Cache (опционально):** Кэш инструкций для ускорения выборки инструкций из памяти.
*   **Data Cache (опционально):** Кэш данных для ускорения доступа к данным.
*   **Timer and Software Interrupt Module (опционально):** Таймер и модуль программных прерываний.
*   **Instruction Tightly Coupled Memory (опционально):** Тесно связанная память для инструкций.
*   **Data Tightly Coupled Memory (опционально):** Тесно связанная память для данных.
*   **Arithmetic Logic Unit:** Арифметико-логическое устройство, выполняющее арифметические и логические операции.
*   **Floating Point Unit (опционально):** Блок для выполнения операций с плавающей запятой.
*   **Multiply and Divide Unit (опционально):** Блок для выполнения операций умножения и деления.
*   **Custom Instruction Logic (опционально):** Логика для реализации пользовательских инструкций.

**Шины:**
*   **32-bit AXI4 Instruction Bus:** 32-битная шина AXI4 для передачи инструкций.
*   **32-bit AXI4 Data Bus:** 32-битная шина AXI4 для передачи данных.
*   **32-bit AXI-Lite:** Две 32-битные шины AXI-Lite для взаимодействия с периферией.

**Отладочные опции (красные):**
*   **Breakpoints:** Точки останова, позволяющие приостанавливать выполнение программы в определенных местах для отладки.

**Важно отметить:**
*   Светло-голубым цветом обозначены опциональные компоненты, то есть они могут присутствовать или отсутствовать в зависимости от конфигурации процессора.
*   Красным цветом обозначены компоненты, связанные с отладкой.

### Примеры применения
1. Accelerating Nios II Ethernet Applications: Ускорение Ethernet-приложений на процессоре Nios II.
	- **Описание:** Ethernet является стандартным способом подключения к сетям. Процессоры Nios II могут быть использованы для управления Ethernet-контроллерами напрямую на ПЛИС. Это позволяет разработчикам создавать настраиваемые сетевые интерфейсы и управлять потоком данных эффективнее, чем при использовании стандартных микроконтроллеров.
	- **Пример:** Реализация TCP/IP стека на Nios II для обеспечения коммуникации между встраиваемым устройством и сетью. Использование DMA (Direct Memory Access) для ускорения передачи данных между Ethernet-модулем и памятью.
2. Design of Data Communication between Nios II and Computer: Проектирование данных для коммуникации между Nios II и компьютером.
	- **Описание:** Эффективная передача данных между ПЛИС, на которой работает Nios II, и внешним компьютером — ключевая задача для многих встраиваемых систем. Nios II может использоваться для управления протоколами сериализации данных, обработки прерываний и буферизации для оптимизации этого процесса.
	- **Пример:** Использование USB, UART, или Ethernet для передачи данных, где Nios II управляет протоколом и обеспечивает корректное формирование и приём пакетов данных.
3. Dynamic Reconfigurable Storage and Pretreatment System of SAR Signal Processing Using Nios II Architecture: Динамически реконфигурируемое хранилище и система предварительной обработки сигналов SAR (Synthetic Aperture Radar) с использованием архитектуры Nios II.
	- **Описание:** SAR — это метод радиолокационного наблюдения, часто используемый для землеустроительства, картографии и военных приложений. ПЛИС с Nios II идеально подходят для обработки SAR сигналов благодаря возможности быстрой обработки данных и реконфигурации аппаратных ресурсов в реальном времени.
	- **Пример:** Реализация алгоритмов FFT (Быстрое Преобразование Фурье) и фильтрации на Nios II для предварительной обработки SAR сигналов перед дальнейшим анализом.
4. Исполняемый Код Софт-Процессора Nios II для Коммуникации и Калибровки Измерителя Интервалов Времени: Коммуникация и калибровка измерителя интервалов времени с использованием Nios II.
	- **Описание:** Измерители интервалов времени часто используются в научных и инженерных приложениях для точного измерения временных интервалов. Софт-процессор Nios II может обрабатывать данные, управлять калибровкой и обеспечивать интерфейс пользователя для этих устройств.
	- **Пример:** Разработка программного обеспечения на Nios II для управления АЦП (аналого-цифровым преобразователем), считывания измерений и реализация алгоритма калибровки. Коммуникация с ПК для вывода результатов измерений.
5. Аппаратная Верификация Рекуррентного Обработчика Сигналов на ПЛИС: Аппаратная верификация рекуррентного обработчика сигналов на ПЛИС с использованием Nios II.
	- **Описание:** Рекуррентные обработчики сигналов необходимы в системах, где требуется анализ временных последовательностей или реализация фильтров. Использование Nios II для аппаратной верификации позволяет разработчикам тестировать и оптимизировать эти обработчики в условиях, максимально приближенных к реальным.
	- **Пример:** Применение Nios II для реализации и тестирования рекуррентных нейронных сетей или фильтров Калмана в аппаратной среде. Это включает в себя имитацию входных сигналов, мониторинг выходных данных и анализ производительности фильтра.

## Lattice Semiconductor
Lattice Semiconductor является одним из ведущих производителей программируемых логических интегральных схем (ПЛИС), и в их портфолио есть ряд интересных решений для разработки встраиваемых систем. Они предлагают различные микропроцессорные ядра, включая LatticeMico32 и ядра на основе архитектуры RISC-V, такие как RISC-V MC CPU IP Core и RISC-V RX CPU IP Core.

### RISC-V MC CPU IP Core
Микроконтроллерное ядро, основанное на открытой архитектуре RISC-V, предназначенное для использования в ПЛИС Lattice
- **Архитектура:** Основано на архитектуре RISC-V, что обеспечивает высокую модульность и расширяемость.
- **Конфигурация:** Поддерживает RV32I базовый набор инструкций RISC-V, включая целочисленные операции и стандартный набор инструкций управления потоком.
- **Размер кода и память:** Минимальный размер ядра позволяет его использовать в ПЛИС с ограниченными ресурсами, поддерживает эффективное использование памяти.
- **Периферия:** Интеграция с шиной Wishbone для подключения стандартной и пользовательской периферии.
- **Энергоэффективность:** Оптимизировано для низкого энергопотребления, что важно для портативных и IoT устройств.
- **Применение:** Идеально подходит для создания микроконтроллеров в пользовательских приложениях, включая умные сенсоры, устройства управления и небольшие встраиваемые системы.

![](../attachments/Pasted%20image%2020241215172027.png)

Основные блоки:
- RISC-V MC CPU Core: Собственно, ядро процессора, реализующее набор инструкций RISC-V для микроконтроллеров.
- RISC-V MC CPU Core Debug: Блок отладки ядра RISC-V MC, позволяющий выполнять пошаговую отладку, устанавливать точки останова, просматривать и изменять состояние ядра.
- Instruction Cache: Кэш инструкций, предназначенный для ускорения выборки инструкций из памяти.
- Data Cache: Кэш данных, предназначенный для ускорения доступа к данным.
- Instruction Port: Порт инструкций, через который ядро получает инструкции.
- Data Port: Порт данных, через который ядро обменивается данными с памятью.

Интерфейсы:
- JTAG: Стандартный интерфейс отладки, используемый блоком RISC-V MC CPU Core Debug.
- AHB-L Manager (x2): Два интерфейса AHB-Lite (Advanced High-performance Bus - Lite), вероятно, один для инструкций, другой для данных. AHB-Lite - это упрощенная версия шины AHB, часто используемая в микроконтроллерах.
- External Interrupts: Вход для внешних прерываний.
- Timer Interrupts: Вход для прерываний от таймера.
- Software Interrupts (tie0): Вход для программных прерываний.
- clk: Вход тактового сигнала.
- reset: Вход сигнала сброса.

Общая характеристика:
- Специализация: Ядро предназначено для использования в микроконтроллерах (MC - Microcontroller).
- Открытая архитектура: Ядро основано на открытой архитектуре набора команд RISC-V.
- Кэширование: Наличие кэшей инструкций и данных повышает производительность.
- Стандартные интерфейсы: Использование стандартных интерфейсов JTAG и AHB-Lite упрощает интеграцию ядра в систему.

### RISC-V RX CPU IP Core
Более продвинутое ядро на базе RISC-V, предназначенное для выполнения более требовательных задач.
- **Архитектура:** RISC-V, поддерживающая RV32IMAC (Integer, Multiplication, Atomic instructions, and Compressed instructions), что делает ядро более мощным для обработки данных и арифметических задач.
- **Конвейер:** Улучшенная многостадийная архитектура для повышения производительности.
- **Модульность:** Поддерживает конфигурирование ядра с различными опциями для управления размером и производительностью.
- **Периферия:** Расширенная поддержка периферии через шины Wishbone и AXI4, упрощающие интеграцию с другими IP-блоками.
- **Производительность:** Оптимизировано для высокопроизводительных вычислений и обработки больших объемов данных.
- **Применение:** Подходит для применений, требующих высокой производительности, включая обработку мультимедиа, системы машинного зрения и комплексные управляющие системы.

## LatticeMico32: характеристики, особенности.
**LatticeMico32** — это 32-битное микропроцессорное ядро с открытым исходным кодом, разработанное Lattice Semiconductor.  Это ядро RISC, предназначенное для реализации на ПЛИС Lattice, и вот его ключевые характеристики:

- **Архитектура:** 32-битный RISC набор инструкций. LatticeMico32 основана на простой и эффективной RISC-архитектуре, что делает ядро легким для понимания и программирования.
- **Конвейер:** 32-битная архитектура с 6-стадийным конвейером исполнения
	- **ADDRESS:** Вычисление адреса команды, где процессор определяет, откуда загрузить следующую команду.
	- **FETCH:** Выборка команды из памяти.
	- **DECODE:** Декодирование команды, определение типа операции и регистров, которые будут использоваться.
	- **EXECUTE:** Исполнение команды, где происходит выполнение арифметических или логических операций.
	- **MEMORY:** Обращение к памяти или вторая стадия исполнения для команд, требующих доступа к памяти.
	- **WRITEBACK:** Запись результата операции обратно в регистр.
- **Аппаратная реализация операций умножения и деления:** LatticeMico32 включает в себя аппаратную поддержку операций умножения и деления, что ускоряет выполнение соответствующих арифметических операций и повышает общую производительность ядра.
- **Отсутствие аппаратной поддержки операций с плавающей точкой**: LatticeMico32 не имеет аппаратной поддержки операций с плавающей точкой. Это означает, что все операции с плавающей точкой должны быть эмулированы программно, что может быть менее эффективно по сравнению с аппаратной поддержкой.
- **Кэш-память**:
	- **Инструкции:** 16 Кб для кэш-памяти инструкций, что помогает ускорить процесс выборки инструкций.
	- **Данные:** 16 Кб для кэш-памяти данных, что ускоряет доступ к данным и повышает общую производительность процессора.
- LatticeMico32 использует системную шину **Wishbone**, стандартную шину для соединения IP-блоков в ПЛИС. Это обеспечивает гибкость в интеграции различной периферии и упрощает проектирование системы на кристалле (SoC).
- LatticeMico32 поддерживает до **32 источников прерываний**, что позволяет обрабатывать события от внешней периферии, такой как GPIO, UART, SPI, и I2C. Это обеспечивает гибкое и эффективное взаимодействие с внешними устройствами.
- Один из ключевых аспектов LatticeMico32 — это **возможность пользовательской конфигурации, включая добавление собственных инструкций и интеграцию собственной периферии**. Это позволяет разработчикам оптимизировать ядро под конкретные прикладные задачи, улучшая производительность и снижая потребление ресурсов ПЛИС.
### Архитектура
![](../attachments/Pasted%20image%2020241215172641.png)

На двух диаграммах изображены архитектура 32-разрядного микропроцессора LatticeMico32 и его интеграция в ПЛИС (FPGA) Lattice.

### Верхняя диаграмма: Архитектура LatticeMico32
**Основные блоки:**
*   **Program Counter:** Счетчик команд. Хранит адрес следующей выполняемой инструкции.
*   **Optional Instruction Cache:** Опциональный кэш инструкций. Ускоряет выборку инструкций из памяти.
*   **32-bit Wide Instruction Memory:** 32-разрядная память инструкций.
*   **Instruction Register:** Регистр инструкций. Хранит текущую выполняемую инструкцию.
*   **Instruction Decoder:** Декодер инструкций. Интерпретирует инструкцию и генерирует управляющие сигналы.
*   **Register File:** Регистровый файл. Содержит набор регистров общего назначения для хранения данных.
*   **Adder:** Сумматор. Используется для вычисления адресов и других арифметических операций.
*   **Control/Status Registers:** Регистры управления и состояния. Используются для настройки и контроля работы процессора.
*   **Logical Operands:**  Блок, подготавливающий операнды для логических операций.
*   **Optional Data Cache:** Опциональный кэш данных. Ускоряет доступ к данным в памяти.
*   **Data Memory:** Память данных.
*   **Shifter:** Сдвиговое устройство. Выполняет операции сдвига над данными.
*   **Multiply & Divide:** Блок умножения и деления. Выполняет операции умножения и деления.
*   **Bypass and Interlock:**  Блок обхода (байпаса) и блокировки. Используется для оптимизации выполнения конвейеризированных инструкций и разрешения конфликтов данных.
*   **Align:** Блок выравнивания. Используется для выравнивания данных в памяти.
**Интерфейсы:**
*   **WISHBONE Bus Instructions:** Интерфейс WISHBONE для инструкций.
*   **WISHBONE Bus Data:** Интерфейс WISHBONE для данных.
### Нижняя диаграмма: Интеграция LatticeMico32 в ПЛИС
**Компоненты:**
*   **LatticeMico32 Processor Core:** Ядро процессора LatticeMico32.
*   **WISHBONE:** Шина WISHBONE, соединяющая процессор с другими компонентами системы.
*   **On-Chip Memory:** Встроенная память.
*   **32-bit Timer:** 32-разрядный таймер.
*   **SRAM Controller:** Контроллер статической памяти (SRAM).
*   **UART:** Универсальный асинхронный приемопередатчик (для последовательной связи).
*   **GPIO:** Порт ввода-вывода общего назначения.
*   **Flash Memory Controller:** Контроллер флэш-памяти.
*   **Interrupt Lines:** Линии прерываний, соединяющие периферийные устройства с процессором.

**Общая характеристика:**
*   **Открытая архитектура:** LatticeMico32 - процессор с открытой архитектурой, что позволяет пользователям модифицировать его под свои нужды.
*   **Интерфейс WISHBONE:**  Использование стандартного интерфейса WISHBONE упрощает интеграцию процессора с различными периферийными устройствами.
*   **Гибкость:**  Опциональные кэши инструкций и данных позволяют оптимизировать производительность в зависимости от требований приложения.
*   **Интеграция в ПЛИС:**  Диаграмма показывает, как процессор интегрируется в систему на кристалле (SoC) на базе ПЛИС Lattice, взаимодействуя с различными периферийными блоками через шину WISHBONE.
### Примеры применения софт-процессоров Lattice
1. **Software-Programmable FPGA IoT Platform**: софт-процессоры Lattice используются для создания гибких и эффективных IoT платформ, способных адаптироваться к изменяющимся требованиям приложений и стандартов связи.
	- **Описание:** IoT платформы на базе ПЛИС с софт-процессорами Lattice позволяют разработчикам оптимизировать свои системы для обработки данных, управления сетевыми протоколами и выполнения пользовательских алгоритмов без необходимости изменения аппаратного обеспечения.
	- **Примеры применения:**
		- **Умный дом и автоматизация:** Интеграция с датчиками и актуаторами через GPIO, управление через протоколы Zigbee или Z-Wave, обработка сигналов от датчиков в реальном времени.
		- **Промышленный IoT:** Сбор и предварительная обработка данных с датчиков на производственных линиях, обеспечение связи с центральными системами управления через Ethernet или Wi-Fi.
		- **Устройства носимой электроники:** Обработка данных с акселерометров, гироскопов и других датчиков для умных часов и фитнес-браслетов.
2. **Разработка радиационно-стойкого микроконтроллера на основе базового матричного кристалла**: позволяет создать устройства, способные функционировать в экстремальных условиях, включая космическое пространство и радиационные зоны.
	- **Описание:** Использование софт-процессоров в радиационно-стойких микроконтроллерах позволяет обеспечить высокую надёжность работы в условиях интенсивного радиационного воздействия. Способность ПЛИС к реконфигурации в реальном времени позволяет исправлять возникающие ошибки и поддерживать функционирование системы даже при повреждении отдельных её частей.
	- **Примеры применения:**
		- **Космические аппараты и спутники:** Управление научными инструментами, обработка данных с бортовых датчиков, обеспечение связи и навигации.
		- **Радиационная разведка:** Работа в условиях высоких уровней радиации, обработка сигналов от детекторов радиации, автоматическая реконфигурация для восстановления функциональности после сбоев.
		- **Робототехника для аварийных работ:** Управление роботами в условиях высокого радиационного фона, например, на аварийных объектах атомных станций.

Примеры дополнительных применений софт-процессоров Lattice
- **Системы видеонаблюдения и обработки изображений:**
  - **Описание:** Софт-процессоры Lattice используются для обработки и анализа видеопотока в системах безопасности и видеонаблюдения.
  - **Применение:** Реализация алгоритмов обнаружения движения, анализа видео в реальном времени, компрессии видеоданных.
- **Системы беспроводной связи:**
  - **Описание:** Применение в базовых станциях и устройствах связи для обработки сигналов, управления протоколами и маршрутизации данных.
  - **Применение:** Реализация функций управления частотой, фильтрации сигналов, кодирования и декодирования информации.
- **Автомобильные системы:**
  - **Описание:** Использование в автомобильных системах для обработки данных с датчиков, управления двигателем и системами безопасности.
  - **Применение:** Управление системами ABS, обработка сигналов от парковочных датчиков
## AMD/Xilinx PicoBlaze: характеристики, особенности
AMD/Xilinx предлагает разнообразные софт-процессоры, которые могут быть реализованы на их программируемых логических интегральных схемах (ПЛИС). Два наиболее известных софт-процессора от Xilinx — это **PicoBlaze** и **MicroBlaze**. Оба процессора предназначены для различных задач и требований в области встраиваемых систем.

**PicoBlaze** — это простой 8-битный софт-процессор RISC (Reduced Instruction Set Computer), предназначенный для реализации на ПЛИС Xilinx. Этот процессор предлагает простую и эффективную возможность управления логикой ПЛИС с минимальным использованием ресурсов.
- **Архитектура:** 8-битный RISC процессор.
- **Количество инструкций:** Поддерживает до 1024 инструкций программы в ОЗУ.
- **Регистры:** Имеет 16 общих регистров (в некоторых версиях до 32).
- **Скорость:** Может исполнять до 100 миллионов инструкций в секунду (в зависимости от тактовой частоты ПЛИС).
- **Память:** Поддерживает до 64 КБ данных для программ и данных.
- **Минимальное использование ресурсов:** Требует всего несколько десятков логических элементов.

Примеры:
1. **Управление периферийными устройствами:** Используется для управления внешней периферией, такой как SPI, UART, I2C.
2. **Простые задачи управления:** Может выполнять простые задачи управления, такие как чтение датчиков, управление двигателями, LED индикация.
3. **Протокольная обработка:** Использование в качестве контроллера для обработки простых сетевых протоколов и интерфейсов.

**MicroBlaze** — это более мощный 32-битный RISC софт-процессор, также предназначенный для реализации на ПЛИС Xilinx. MicroBlaze предлагает более высокую производительность и больше функциональных возможностей по сравнению с PicoBlaze и подходит для более сложных встраиваемых систем.
- **Архитектура:** 32-битный RISC процессор.
- **Конвейер:** 3-стадийный или 5-стадийный конвейер.
- **Поддержка FPU:** Опциональная поддержка операций с плавающей точкой.
- **Память:** Поддерживает различные типы внешней и внутренней памяти.
- **Прерывания:** Поддержка до 32 внешних прерываний.
- **Скорость:** Может достигать скорости более 300 DMIPS при работе на частоте до 500 MHz в некоторых ПЛИС.
- **Ресурсы ПЛИС:** Требует от нескольких сотен до нескольких тысяч логических элементов в зависимости от конфигурации.

Примеры:
1. **Сложные встраиваемые системы:** Использование в системах, требующих обработки больших объемов данных, таких как видеообработка, обработка аудиосигналов.
2. **Сетевые устройства:** Реализация сетевых протоколов, маршрутизаторов, мостов и других сетевых функций.
3. **Промышленные системы управления:** Управление сложными механическими системами, обработка сигналов с множества датчиков, реализация алгоритмов автоматического управления.
4. **Образовательные проекты:** Использование в качестве обучающей платформы для изучения архитектуры процессоров, систем на кристалле и встраиваемого программирования.

PicoBlaze и MicroBlaze предоставляют разработчикам две различные платформы для создания встраиваемых систем на ПЛИС Xilinx. PicoBlaze идеально подходит для простых задач и минимизации использования ресурсов ПЛИС, в то время как MicroBlaze предлагает более высокую производительность и больше возможностей для реализации сложных многозадачных приложений. Оба процессора являются ключевыми инструментами в арсенале инженера, работающего с ПЛИС Xilinx, и могут быть использованы в широком спектре приложений от простых устройств до сложных многофункциональных систем.

## AMD/Xilinx PicoBlaze: характеристики, особенности
**PicoBlaze** от Xilinx является примером компактного и эффективного 8-битного софт-процессора, разработанного специально для использования в FPGA. Он представляет собой простой микроконтроллер RISC, оптимизированный для реализации на программируемых логических интегральных схемах (ПЛИС) и идеально подходит для управления периферией, выполнения простых вычислений и обработки прерываний.

 1. **Архитектура и Вычислительные Особенности**
	- **8-битные инструкции:** Простая и эффективная архитектура, позволяющая выполнение базовых операций и управление потоком выполнения.
	- **8-битные данные:** Работа с данными ограничивается 8-битными значениями, что типично для многих простых микроконтроллеров.
	- **RISC архитектура:** Простой набор инструкций, обеспечивающий высокую скорость выполнения и простоту использования.
2. **Регистры и Память**
	- **16 байтовых регистров общего назначения:** Обеспечивает достаточную гибкость для выполнения большинства задач управления и базовых вычислений.
	- **1К инструкций программируемого ПЗУ:** Инструкции загружаются в ПЛИС во время конфигурации, обеспечивая быстрый старт и работу.
	- **Внутренняя оперативная память объемом 64 байта:** Используется для временного хранения данных и промежуточных вычислений.
3. **Арифметико-логический блок (АЛУ) и Управление**
	- **8-битный АЛУ с флагами CARRY (переноса) и ZERO (нуля):** Позволяет выполнять арифметические и логические операции над 8-битными числами.
	- **Автоматический стек вызовов/возвратов на 31 позицию:** Упрощает реализацию подпрограмм и обработчиков прерываний.
4. **Ввод/Вывод и Прерывания**
	- **256 входных и 256 выходных портов:** Обширные возможности для взаимодействия с периферией.
	- **Быстрая обработка прерываний:** В худшем случае обработка прерывания занимает 5 тактов, что обеспечивает отзывчивость системы.
5. **Производительность и Ресурсоемкость**
	- **Выполнение каждой инструкции за два такта:** На частоте 200 МГц процессор обеспечивает производительность 100 MIPS.
	- **Оптимизировано для Xilinx Spartan-3:** Занимает всего 96 Slices и 0,5-1 блок RAM, что делает его идеальным для использования в небольших и средних FPGA.
	- **Поддержка архитектур Spartan-6 и Virtex-6 FPGA:** Показывает гибкость PicoBlaze в использовании с различными семействами ПЛИС от Xilinx.

PicoBlaze является примером универсального и эффективного решения для реализации в FPGA, особенно когда требуется минимальное потребление ресурсов и высокая скорость работы. Этот процессор можно использовать в широком спектре приложений, от простого управления периферией до реализации базовых систем управления и обработки данных.

### Архитектура микроконтроллера PicoBlaze
![700](../attachments/Pasted%20image%2020241215174643.png)

**Основные блоки:**
*   **1Kx18 Instruction PROM:** Память программ (PROM) объемом 1К слов по 18 бит. Здесь хранится программа, которую выполняет микроконтроллер.
*   **Program Counter (PC):** Счетчик команд. Содержит адрес текущей выполняемой инструкции.
*   **31x10 CALL/RETURN Stack:** Стек вызовов/возвратов глубиной 31 уровень, разрядностью 10 бит. Используется для хранения адресов возврата при вызове подпрограмм и прерываний.
*   **Instruction Decoder:** Декодер инструкций. Интерпретирует код инструкции и генерирует управляющие сигналы для других блоков.
*   **64-Byte Scratchpad RAM:** Оперативная память (RAM) объемом 64 байта. Используется для временного хранения данных.
*   **16 Byte-Wide Registers (s0-sF):** 16 байтовых регистров общего назначения (s0-sF).
*   **ALU (Arithmetic Logic Unit):** Арифметико-логическое устройство. Выполняет арифметические и логические операции над данными.
*   **Flags (Z - Zero, C - Carry):** Флаги состояния: Z (нулевой результат) и C (перенос).

**Входы/выходы:**
*   **IN_PORT:** Порт ввода.
*   **OUT_PORT:** Порт вывода.
*   **PORT_ID:** Идентификатор порта.
*   **INTERRUPT:** Вход прерывания.
*   **IE (Interrupt Enable):**  Вход разрешения/запрещения прерываний.

**Сигналы:**
*   **Constants:** Константы, поступающие в регистры или ОЗУ.
*   **Operand 1, Operand 2:** Операнды для АЛУ.

**Особенности архитектуры:**
*   **Простота:** PicoBlaze имеет простую архитектуру, что делает его компактным и энергоэффективным.
*   **Фиксированная длина инструкции:** Все инструкции имеют фиксированную длину (18 бит).
*   **Ограниченная память:** Объем памяти программ (1К слов) и данных (64 байта) ограничен.
*   **Стековая организация:** Для вызовов подпрограмм и обработки прерываний используется аппаратный стек.
*   **Предназначен для встраиваемых систем:** PicoBlaze разработан специально для использования в ПЛИС, в частности, в ПЛИС компании Xilinx.

**Принцип работы (упрощенно):**
1. Счетчик команд (PC) указывает на текущую инструкцию в памяти программ.
2. Инструкция считывается из памяти и поступает в декодер инструкций.
3. Декодер инструкций определяет, какую операцию необходимо выполнить.
4. Если необходимо, считываются операнды из регистров или из порта ввода.
5. ALU выполняет операцию, и результат записывается в регистр, память или порт вывода.
6. Флаги Z и C обновляются в соответствии с результатом операции.
7. Счетчик команд обновляется, и процессор переходит к следующей инструкции.
8. При поступлении сигнала прерывания (и если прерывания разрешены), текущее состояние процессора сохраняется в стеке, и управление передается обработчику прерывания.

В целом, PicoBlaze - это компактный и простой микроконтроллер, хорошо подходящий для реализации несложных задач управления в ПЛИС.

### Примеры
1. A Time Interval Measurement System Based on FPGA Used for Frequency Calibration: Измерение временных интервалов для калибровки частоты
	- **Описание**: В этом приложении PicoBlaze используется для управления системой измерения временных интервалов, которая критична для калибровки и верификации частотных стандартов. Процессор управляет сбором данных, обработкой результатов измерений и коммуникацией с внешними устройствами.
	- **Реализация**:
		- **Управление АЦП**: PicoBlaze может управлять аналого-цифровыми преобразователями для сбора аналоговых сигналов, которые представляют временные интервалы.
		- **Обработка данных**: Выполняет предварительную обработку и фильтрацию данных для улучшения точности измерений.
		- **Интерфейс пользователя**: Управляет отображением результатов на дисплее или передачей данных на компьютер для дальнейшего анализа.
2. A Scalable Hardware/Software Co-Design for Elliptic Curve Cryptography on PicoBlaze Microcontroller: Реализация криптографии на эллиптических кривых
	- **Описание**: В этом проекте PicoBlaze применяется в качестве ключевого элемента системы на кристалле (SoC) для реализации алгоритмов криптографии на эллиптических кривых (ECC). Это требует от микроконтроллера выполнения сложных математических операций и управления памятью.
	- **Реализация**:
		- **Вычисления**: PicoBlaze управляет арифметикой больших чисел, необходимой для работы с эллиптическими кривыми.
		- **Безопасность**: Обеспечивает выполнение криптографических алгоритмов с высокой степенью безопасности, используя минимальные ресурсы FPGA.
		- **Масштабируемость**: Система может быть масштабирована с добавлением дополнительных PicoBlaze для увеличения производительности.
3. A PicoBlaze-Based Embedded System for Monitoring Applications: Встраиваемая система мониторинга
	- **Описание**: PicoBlaze часто используется в системах мониторинга для сбора, обработки и передачи данных с датчиков. Процессор может обрабатывать сигналы, управлять связью и оптимизировать потребление энергии.
	- **Реализация**:
		- **Сбор данных**: Управление датчиками для сбора информации о температуре, давлении, влажности и других параметрах.
		- **Обработка и хранение**: Предобработка данных перед сохранением в память или отправкой на сервер.
		- **Управление энергопотреблением**: Оптимизация работы системы для работы от батарей в удалённых местах.
4. Программное Обеспечение Спутникового Модема "ЯР-1040": Управление работой спутникового модема
	- **Описание**: В спутниковых модемах PicoBlaze может быть использован для управления обработкой сигналов, реализации протоколов связи и обеспечения интерфейса с пользователем.
	- **Реализация**:
		- **Обработка сигналов**: Управление процессами модуляции и демодуляции сигналов для обеспечения стабильной спутниковой связи.
		- **Протокольная обработка**: Реализация стека протоколов для обработки команд и данных, передаваемых через спутник.
		- **Интерфейс пользователя**: Обеспечивает интерактивность с пользователем через консоль или веб-интерфейс для настройки параметров работы модема.
## AMD/Xilinx MicroBlaze: характеристики, особенности
**MicroBlaze** от AMD/Xilinx — это мощный и гибкий 32-битный софт-процессор, реализуемый на FPGA. Он предназначен для широкого спектра применений от простых встраиваемых систем до сложных многозадачных приложений, требующих значительной производительности и оптимизации ресурсов. MicroBlaze обладает множеством конфигурируемых параметров, что позволяет разработчикам тонко настраивать его для конкретных нужд.

1. **Регистры и Инструкции**
	- **Тридцать два 32-битных или 64-битных регистра общего назначения:** Это обеспечивает гибкость и мощь в обработке данных, позволяя эффективно работать как с 32-битными, так и с 64-битными операциями.
	- **32-битная инструкция с тремя операндами:** Стандартный формат инструкций упрощает ассемблерную разработку и оптимизацию компиляторов, поддерживая три операнда для максимальной гибкости и эффективности кода.
2. **Адресация и Память**
	- **32-битная шина адреса по умолчанию с возможностью расширения до 64 бит:** Это позволяет адресовать до 4 ГБ памяти напрямую в 32-битном режиме и значительно больше в 64-битном режиме, обеспечивая масштабируемость для более крупных и сложных систем.
	- **Два режима адресации:** Поддержка различных режимов адресации увеличивает гибкость при работе с разнообразными структурами данных.
3. **Конвейер и Оптимизация**
	- **Конфигурация конвейера в зависимости от параметра оптимизации:**
		- **C_AREA_OPTIMIZED = 0 (Area):** Используется трёхстадийный конвейер (Fetch, Decode, and Execute), что минимизирует использование логических элементов и памяти, полезно для простых и компактных приложений.
		- **C_AREA_OPTIMIZED = 1 (Performance):** Пятистадийный конвейер (Fetch, Decode, Execute, Access Memory, and Writeback) обеспечивает баланс между производительностью и ресурсоёмкостью, оптимален для большинства задач.
		- **C_AREA_OPTIMIZED = 2 (Frequency):** Восьмистадийный конвейер (Fetch, Decode, Execute, Access Memory 0, Access Memory 1, Access Memory 2, Access Memory 3, and Writeback) используется для достижения максимальной тактовой частоты и производительности.

**MicroBlaze** является мощным и гибким инструментом для разработки встраиваемых систем на FPGA, предлагая широкие возможности для настройки и оптимизации под конкретные задачи. Его использование в калибровке частот, криптографии, системах мониторинга и управлении спутниковыми модемами демонстрирует универсальность и высокую производительность в различных областях применения.

### Архитектура
![](../attachments/Pasted%20image%2020241215175736.png)

Серым цветом выделены опциональные компоненты.

**Основные блоки:**
*   **Register File (32 registers):**  Регистровый файл, содержащий 32 32-разрядных регистра общего назначения.
*   **Instruction Decode:** Декодер инструкций. Интерпретирует код инструкции и генерирует управляющие сигналы для других блоков.
*   **ALU (Arithmetic Logic Unit):** Арифметико-логическое устройство. Выполняет арифметические и логические операции над данными.
*   **Shift:**  Сдвиговое устройство (сдвиг на один бит).
*   **Barrel Shifter (Optional):**  Сдвиговое устройство с произвольным сдвигом (на любое количество бит за один такт).
*   **Multiplier (Optional):** Аппаратный умножитель.
*   **Divider (Optional):** Аппаратный делитель.
*   **FPU (Floating Point Unit) (Optional):**  Блок операций с плавающей запятой.
*   **Program Counter:** Счетчик команд. Содержит адрес следующей выполняемой инструкции.
*   **Branch Target Cache (Optional):** Кэш адресов ветвлений. Ускоряет выполнение условных и безусловных переходов.
*   **Instruction Buffer:** Буфер инструкций.
*   **Special Purpose Registers:** Регистры специального назначения.
**Управление памятью:**
*   **Memory Management Unit (MMU) (Optional):** Блок управления памятью. Обеспечивает трансляцию виртуальных адресов в физические, а также защиту памяти.
*   **ITLB (Instruction Translation Lookaside Buffer) (Optional):** Буфер ассоциативной трансляции адресов для инструкций. Кэширует недавно использованные трансляции виртуальных адресов инструкций в физические. Является частью MMU.
*   **UTLB (Unified Translation Lookaside Buffer) (Optional):** Унифицированный буфер ассоциативной трансляции адресов. Кэширует трансляции как для инструкций, так и для данных. Является частью MMU.
*   **DTLB (Data Translation Lookaside Buffer) (Optional):** Буфер ассоциативной трансляции адресов для данных. Кэширует недавно использованные трансляции виртуальных адресов данных в физические. Является частью MMU.
**Кэши:**
*   **I-Cache (Instruction Cache) (Optional):** Кэш инструкций. Хранит копии наиболее часто используемых инструкций для ускорения их выборки.
*   **D-Cache (Data Cache) (Optional):** Кэш данных. Хранит копии наиболее часто используемых данных для ускорения доступа к ним.
**Интерфейсы:**
*   **Instruction-side Bus Interface:**  Шинный интерфейс со стороны инструкций.
    *   **M_AXI_IC, M_ACE_IC:** Интерфейсы AXI (Advanced eXtensible Interface) и ACE (AXI Coherency Extensions) для кэша инструкций.
    *   **M_AXI_IP:** Интерфейс AXI, вероятно, для прямого доступа к памяти инструкций (без кэширования).
    *   **ILMB (Instruction Local Memory Bus):**  Локальная шина памяти для инструкций.
*   **Data-side Bus Interface:**  Шинный интерфейс со стороны данных.
    *   **M_AXI_DC, M_ACE_DC:**  Интерфейсы AXI и ACE для кэша данных.
    *   **M_AXI_DP:** Интерфейс AXI, вероятно, для прямого доступа к памяти данных (без кэширования).
    *   **DLMB (Data Local Memory Bus):** Локальная шина памяти для данных.
*   **Bus IF:** Блок шинного интерфейса.
*   **M0_AXIS .. M15_AXIS:**  До 16 выходных интерфейсов AXI Stream.
*   **S0_AXIS .. S15_AXIS:** До 16 входных интерфейсов AXI Stream.

**Особенности:**
*   **Гибкая конфигурация:**  MicroBlaze имеет множество опциональных компонентов, что позволяет сконфигурировать процессор в соответствии с требованиями конкретного приложения.
*   **Поддержка MMU:** Опциональный блок MMU обеспечивает поддержку виртуальной памяти и защиту памяти, что важно для сложных операционных систем.
*   **Различные интерфейсы:** Поддержка различных интерфейсов, таких как AXI, ACE и LMB, упрощает интеграцию процессора в систему.
*   **Производительность:**  Наличие кэшей, аппаратного умножителя, делителя и блока операций с плавающей запятой обеспечивает высокую производительность.


**MicroBlaze** от AMD/Xilinx является высоко настраиваемым 32-битным микропроцессорным IP-ядром, предназначенным для реализации на FPGA. Этот процессор может быть сконфигурирован в несколько вариантов, каждый из которых предназначен для различных применений, от простых микроконтроллерных систем до сложных приложений, требующих реального времени и высокой производительности.

### MicroBlaze Microcontroller
Этот вариант MicroBlaze оптимизирован для использования в роли микроконтроллера и предоставляет базовый набор периферийных устройств, необходимых для большинства встраиваемых систем.
- **Интерфейс отладки JTAG:** Позволяет проводить отладку программного обеспечения напрямую через стандартный JTAG интерфейс, что упрощает разработку и тестирование.
- **Локальная память с жесткой связью:** Используется для хранения кода и данных, обеспечивая быстрый доступ к ним без задержек, характерных для внешней памяти.
- **Контроллеры периферии:**
  - **SPI (Serial Peripheral Interface):** Используется для связи с другими микроконтроллерами или периферийными устройствами.
  - **I2C (Inter-Integrated Circuit):** Предоставляет двунаправленные каналы связи для подключения низкоскоростных устройств, таких как датчики и модули памяти.
  - **UART (Universal Asynchronous Receiver/Transmitter):** Обеспечивает асинхронный последовательный обмен данными с компьютерами, терминалами и другими устройствами.
- **Контроллер прерываний:** Управляет прерываниями от периферии, позволяя реагировать на внешние события в режиме реального времени.
- **Таймер:** Необходим для измерения времени и реализации задержек или отсчёта времени для различных задач.
- **GPIO (General-Purpose Input/Output):** Предоставляет универсальные порты ввода-вывода для управления и мониторинга различных внешних устройств.

### MicroBlaze Real-Time Processor
Этот вариант предназначен для приложений, требующих обработки в реальном времени, и включает в себя дополнительные возможности по сравнению с микроконтроллерным вариантом.
- **Все возможности варианта “Microcontroller”**
- **Кэш инструкций и данных:** Улучшает производительность за счёт минимизации задержек при доступе к памяти.
- **Блок управления памятью (MMU):** Позволяет использовать виртуальную память и поддерживать защиту памяти, что важно для операционных систем и сложных приложений.
- **Контроллер памяти DDR:** Обеспечивает высокоскоростной доступ к внешней памяти DDR, что критично для приложений, требующих большого объёма памяти и быстрой работы с данными.

### MicroBlaze Application Processor
Этот вариант является наиболее мощным и предназначен для сложных приложений, требующих высокой производительности и сетевой связи.
- **Все возможности варианта “Real-time Processor”**
- **Контроллер Ethernet:** Позволяет подключать устройство к локальным сетям и интернету, что расширяет возможности устройства для сетевых приложений и удалённого управления

### Примеры использования
1. **Реализация криптографического алгоритма на MicroBlaze (Implementation of Cryptographic Algorithm on MicroBlaze)**  
   MicroBlaze может использоваться для реализации алгоритмов шифрования, таких как AES, RSA, или SHA. Это позволяет разрабатывать защищённые системы обработки данных, например, для IoT-устройств или приложений, требующих высокого уровня безопасности. FPGA обеспечивает параллельное выполнение операций, что ускоряет криптографические вычисления.
2. **Системы и анализ производительности с использованием FPGA (Systems and Performance Analysis Using FPGA)**  
   MicroBlaze используется для построения экспериментальных систем, где производятся измерения и анализ производительности. Это может включать моделирование систем реального времени, выполнение тестов алгоритмов или создание платформы для обучения.
3. **Микросистема для управления двигателем постоянного тока с использованием широтно-импульсной модуляции (A Microsystem Design for Controlling a DC Motor by Pulse Width Modulation Using MicroBlaze Soft-Core)**  
   MicroBlaze может служить ядром системы управления, выполняя расчет и генерацию сигналов ШИМ для управления скоростью и направлением вращения двигателя. Это особенно полезно в робототехнике, автоматизации или управлении транспортными средствами.
4. **Разработка принципиальной схемы генератора синусоидальных сигналов на основе MicroBlaze и ПЛИС**  
   В этом случае MicroBlaze используется для программного управления генератором, который формирует синусоидальные сигналы. Это может применяться в радиочастотных системах, телекоммуникации или тестовых приборах, где требуется формирование сигналов с различными характеристиками.