# 13. Процессорные системы класса СнК (система-на-кристалле).
## Системы-на-кристалле (СнК, SoC). Основные особенности.
![](../attachments/Pasted%20image%2020241209185942.png)

Системы-на-кристалле AMD SoC состоят из двух частей:
- Процессорная система (PS, Processing System)
- Программируемая логика (PL, Programmable Logic)

### Процессорная система (PS, Processing System)
Комплексное ядро системы, которое включает в себя один или несколько центральных процессоров (CPU) и связанную с ними инфраструктуру. Эта часть SoC отвечает за выполнение программного кода, обработку данных и управление операциями ввода-вывода. 

Сердце SoC, которое обычно включает в себя один или несколько центральных процессоров (CPU). В зависимости от модели и назначения SoC, это могут быть:
- **Одноядерные или многоядерные CPU**. Например, AMD может использовать свои мощные ядра Zen или более простые ядра ARM для мобильных и встраиваемых решений.
- **Вспомогательные процессоры**, такие как микроконтроллеры для управления питанием, безопасности или дополнительной обработки данных.
- **Графические процессоры (GPU)**, которые могут быть интегрированы для обработки графики и общих вычислительных задач (GPGPU), как это делается в APU (Accelerated Processing Unit) от AMD.

Также в состав PS входят:
- **Память и кэш**. Прямой доступ к оперативной памяти (DRAM), кэш различных уровней для ускорения доступа к данным.
- **Системный контроллер** для управления вводом-выводом, обработки сигналов от периферийных устройств и управления питанием.

Другая конфигурация:
1. **Центральные Процессоры (CPU):**
   - **Типы ядер:** В зависимости от назначения SoC, AMD может использовать различные архитектуры CPU:
     - **Ядра Zen** — для мощных вычислительных задач в серверных, настольных и мобильных устройствах.
     - **Ядра ARM Cortex** — часто используются в мобильных и встраиваемых системах из-за их энергоэффективности.
   - **Количество ядер:** Может варьироваться от одного для простых устройств до множества в высокопроизводительных системах.
2. **Графический Процессор (GPU):**
   - Интегрированные GPU обеспечивают обработку графики и поддержку вычислений общего назначения (GPGPU), что важно для задач, требующих параллельной обработки данных.
3. **Сопроцессоры и Специализированные Ускорители:**
   - **DSP (Digital Signal Processors)** для обработки аудио и видео сигналов.
   - **AI Accelerators** для задач машинного обучения и искусственного интеллекта.
4. **Память:**
   - **Контроллеры памяти** обеспечивают доступ к оперативной памяти (RAM), часто DDR3, DDR4 или новее.
   - **Кэш память** различных уровней (L1, L2, L3) для ускорения доступа к часто используемым данным.
5. **Ввод/Вывод (I/O) и Периферийные Интерфейсы:**
   - **Системный контроллер I/O** управляет внешними интерфейсами, такими как USB, Ethernet, SATA, PCI Express.
   - **UART, SPI, I2C** для подключения различных внешних устройств и модулей.
6. **Системные Компоненты:**
   - **Таймеры, Часы (Timers and Clock Management)** для управления временем и различными задержками в системе.
   - **Watchdog Timers** для контроля за зависаниями и сбоями системы.
7. **Управление Питанием:**
   - **Power Management Unit (PMU)** оптимизирует потребление энергии, контролируя различные режимы работы SoC.
8. **Системы Безопасности:**
   - **Криптографические ускорители** для быстрой обработки шифрования.
   - **Secure Boot and Trusted Execution Environments** для обеспечения загрузки и исполнения только проверенного кода.

#### Функции Процессорной Системы
Процессорная система выполняет следующие основные функции:
- **Выполнение Инструкций:** CPU обрабатывает инструкции программ, выполняя арифметические, логические и управляющие операции.
- **Обработка Данных:** CPU и сопроцессоры обрабатывают данные, получаемые от памяти, периферии или внешних устройств.
- **Управление Периферией:** Контроллеры ввода-вывода обеспечивают связь с дополнительными устройствами, управляя передачей данных.
- **Многозадачность:** Современные SoC поддерживают многозадачность и многопоточность, позволяя одновременно выполнять несколько программ.
- **Оптимизация Энергопотребления:** PMU и другие механизмы управления питанием минимизируют энергопотребление при максимизации производительности.

Давайте разберем подробнее каждый из компонентов процессорной системы (PS) в SoC, особенно учитывая дополнительные детали, которые вы предоставили. Процессорная система, как правило, включает в себя центральный процессор (CPU), вспомогательные процессоры и контроллеры, а также широкий спектр интерфейсов для обеспечения связи с периферийными устройствами и другими блоками SoC.

#### Основные компоненты процессорной системы (PS)
#### 1. Статический контроллер памяти
- **Quad-SPI:** Контроллер Quad SPI (Serial Peripheral Interface) используется для подключения к быстрой серийной флэш-памяти. Он позволяет читать данные с высокой скоростью благодаря четырехлинейной передаче.
- **NAND:** Контроллер NAND памяти поддерживает подключение к NAND флеш-памяти, которая часто используется для хранения больших объемов данных, например, в эмбеддед системах.
- **NOR:** Контроллер NOR памяти обеспечивает доступ к NOR флеш-памяти, характеризующейся быстрым чтением и надежностью при хранении критически важного кода.
#### 2. Динамический контроллер памяти
- **DDR3, DDR2, LPDDR2:** Контроллеры динамической памяти поддерживают различные типы памяти DDR, включая DDR3, DDR2 и LPDDR2. Это основная оперативная память, используемая для хранения данных и инструкций, которые CPU обрабатывает в реальном времени.
#### 3. Коммутаторы AMBA
- **Advanced Microcontroller Bus Architecture (AMBA):** Это стандарт шины, который используется для соединения различных блоков внутри SoC. Коммутаторы AMBA обеспечивают эффективную коммуникацию и передачу данных между CPU, памятью и периферийными устройствами.
#### 4. Периферийные интерфейсы
- **SPI:** 2 интерфейса Serial Peripheral Interface обеспечивают связь с внешними устройствами, такими как датчики и модули памяти.
- **I2C:** 2 интерфейса Inter-Integrated Circuit используются для связи с различными низкоскоростными периферийными устройствами.
- **CAN:** 2 интерфейса Controller Area Network предназначены для сетевых коммуникаций в автомобильных и промышленных приложениях.
- **UART:** 2 интерфейса Universal Asynchronous Receiver/Transmitter обеспечивают последовательную связь.
- **SDIO:** 2 Secure Digital Input Output интерфейса с поддержкой DMA (Direct Memory Access) для высокоскоростной передачи данных с SD карт.
- **USB:** 2 интерфейса Universal Serial Bus с поддержкой DMA для подключения внешних устройств и быстрой передачи данных.
- **GigE:** 2 интерфейса Gigabit Ethernet с поддержкой DMA для сетевых соединений.
#### 5. Ввод-вывод MUX
- **MUX (Multiplexer):** Позволяет переключать различные сигналы ввода/вывода для разных функций на одних и тех же физических пинах. Это повышает гибкость конфигурации устройства.
#### 6. Дополнительные компоненты
- **GPIO:** General Purpose Input/Output пины используются для управления различными устройствами и считывания сигналов.
- **ARM CoreSight:** Система отладки и трассировки для многопроцессорных систем, поддерживает мониторинг и анализ работы системы в реальном времени.
- **Neon/FPU:** SIMD (Single Instruction Multiple Data) и сопроцессор с плавающей точкой для ускорения вычислений в мультимедийных приложениях и машинном обучении.
#### 7. Кэш-память
- **L1 Cache:** Каждое ядро Cortex-A9 имеет свои кэши инструкций и данных по 32 КБ.
- **L2 Cache:** Общий кэш второго уровня на 512 КБ для ядер, ускоряющий доступ к данным.
#### 8. Системные компоненты
- **Таймеры:** Используются для измерения времени и организации задержек.
- **Общий контроллер прерываний:** Управляет прерываниями от различных устройств, обеспечивая их обработку CPU.
- **DMA:** Контроллеры Direct Memory Access ускоряют передачу данных между памятью и периферией, не загружая при этом CPU.
- **256 КБ встроенной памяти:** Обеспечивает быстрый доступ к часто используемым данным и коду.
- **Блок управления слежкой (SCU):** Управляет координацией данных и кэш-согерентностью в многопроцессорных системах.

#### Общие характеристики и применение
Такая структура процессорной системы позволяет SoC от AMD быть исключительно гибкими и мощными для использования в различных приложениях:

- **Встраиваемые системы:** Используются в промышленных, медицинских и автомобильных приложениях благодаря широкому набору периферийных интерфейсов и возможности эффективной обработки данных.
- **Коммуникационное оборудование:** Серверы и маршрутизаторы используют Gigabit Ethernet для обработки сетевого трафика.
- **Мультимедийные устройства:** Процессоры с поддержкой Neon и FPU обеспечивают высокую производительность в приложениях обработки видео и аудио.
- **Мобильные и портативные устройства:** Энергоэффективные реализации ARM и LPDDR поддерживают длительное время работы от батареи.

Эта комплексная конфигурация PS делает SoC от AMD подходящими для широкого спектра технологических решений, позволяя разработчикам оптимизировать их продукты под конкретные нужды и требования.

### PL
Программируемая логика предоставляет фабрику для создания пользовательских аппаратных решений. Это позволяет динамически реализовывать специализированные обработчики и алгоритмы на аппаратном уровне, что может существенно ускорить обработку данных по сравнению с программным выполнением на CPU.

Программируемая логика (PL, Programmable Logic) в системах-на-кристалле (SoC) от AMD (или в аналогичных устройствах от Xilinx, таких как Zynq-7000 SoC, где AMD и Xilinx тесно сотрудничают после слияния) представляет собой чрезвычайно гибкий и мощный компонент, который позволяет разработчикам адаптировать аппаратное обеспечение под конкретные приложения путём программирования логических блоков и соединений между ними. Это дает возможность оптимизировать производительность, уменьшить время обработки и повысить энергоэффективность системы.

#### Ключевые компоненты Программируемой Логики (PL)
1. **Системные Шлюзы:**
   - **AXI Interconnect:** Системные шлюзы, чаще всего реализованные через AXI (Advanced eXtensible Interface) интерфейсы, обеспечивают надежное соединение между процессорной системой (PS) и программируемой логикой (PL). Это позволяет обмениваться данными между различными частями SoC с высокой пропускной способностью и низкой задержкой.
2. **Логические блоки (Configurable Logic Blocks - CLBs):**
   - **Look-Up Tables (LUTs):** Эти таблицы используются для реализации логических функций. Каждый LUT может быть сконфигурирован для выполнения различных булевых операций.
   - **Flip-Flops:** Регистры, используемые для хранения данных и реализации синхронной логики.
   - **Мультиплексоры:** Позволяют выбирать между несколькими входными сигналами на основе контрольного сигнала.
3. **Цифровые сигнальные блоки (Digital Signal Processing - DSP slices):**
   - Эти блоки предназначены для выполнения специализированных математических операций, таких как умножение и аккумуляция, которые часто используются в цифровой обработке сигналов. DSP блоки значительно ускоряют выполнение операций, связанных с обработкой аудио, видео, и других сигналов реального времени.
4. **Блоки ввода-вывода (Input/Output Blocks - IOBs):**
   - Обеспечивают соединение программируемой логики с внешними пинами SoC, позволяя взаимодействовать с периферийными устройствами.
5. **Память в PL:**
   - **Block RAM (BRAM):** Предоставляют эффективное хранилище данных внутри PL. Это двухпортовые блоки памяти, которые позволяют одновременно читать и записывать данные, обеспечивая высокую скорость доступа.
   - **Ultra RAM (URAM):** Новее и предоставляют больший объем памяти по сравнению с BRAM, используются для хранения больших массивов данных, как в более новых генерациях FPGA.
6. **Пользовательские IP-ядра и функциональные блоки:**
   - Специализированные блоки для определённых функций, такие как шифрование, обработка сетевых пакетов, а также пользовательские ядра, разработанные для конкретных задач.
7. **Переключатели и соединения (Switch Matrix):**
   - Обеспечивают динамическое соединение логических блоков, памяти и IOBs для формирования необходимой схемы.
8. **Многостандартные вводы-выводы:**
   - **3.3 В и высокоскоростные 1.8 В IO:** Вводы-выводы программируемой логики могут работать с различными уровнями напряжения, что позволяет подключать широкий спектр внешних устройств. Высокоскоростные интерфейсы на 1.8 В используются для связи с высокопроизводительными периферийными устройствами, такими как DDR память и сетевые адаптеры.
9. **XADC (Xilinx Analog-to-Digital Converter):**
   - **Аналого-цифровой преобразователь:** XADC — это встроенный аналого-цифровой преобразователь в FPGA, который позволяет измерять аналоговые сигналы, такие как температура, напряжение и ток. Это важно для мониторинга состояния системы и для приложений, требующих обработки аналоговых входных данных.
10. **PCIe (Peripheral Component Interconnect Express):**
   - **Серийный интерфейс:** PCIe обеспечивает высокоскоростную серийную передачу данных между SoC и другими компонентами в компьютере. Это критически важно для приложений, требующих быстрого обмена данными, например, в серверах, системах хранения данных и высокопроизводительных рабочих станциях.
11. **High-Speed Transceivers:** Эти блоки позволяют передавать данные с очень высокой скоростью через сериализованные каналы. Они используются в сетевых приложениях, таких как 10 Gigabit Ethernet, и в других приложениях, требующих быстрой последовательной передачи данных.

Функции и Преимущества Программируемой Логики
- **Гибкость и Реализация Специфической Логики:** Позволяет пользователю реализовывать уникальные алгоритмы и логику обработки данных на аппаратном уровне, что значительно ускоряет выполнение по сравнению с обработкой на CPU.
- **Параллельная Обработка:** В отличие от последовательной обработки в CPU, PL может выполнять множество операций одновременно, что идеально подходит для обработки сигналов, видео и других задач, требующих высокой пропускной способности.
- **Уменьшение Загрузки на CPU:** Выполняя ресурсоёмкие задачи в PL, освобождается CPU, который может заниматься другими задачами или переходить в режим энергосбережения.
- **Высокая Скорость Обработки:** Поскольку логика реализуется напрямую в аппаратном обеспечении, время реакции и задержки минимизируются.

Примеры Применения
1. **Обработка Видеосигналов:** PL часто используют для реализации алгоритмов обработки изображений и видео, таких как кодирование, декодирование, фильтрация и анализ движения.
2. **Сетевые Устройства:** Программируемая логика используется для парсинга и обработки сетевых пакетов в реальном времени, что позволяет реализовать высокопроизводительные сетевые карты и маршрутизаторы.
3. **Беспроводная Связь:** В FPGA можно реализовать алгоритмы для обработки сигналов в системах связи, таких как LTE или 5G, ускоряя обработку сигнала и уменьшая задержки.
4. **Промышленное Применение:** В робототехнике и автоматизации PL позволяет реализовать быструю обработку сенсорных данных, управление двигателями и другие задачи в реальном времени.
5. **Криптография и Безопасность:** Используется для реализации быстрых алгоритмов шифрования и обеспечения безопасности данных.

Программируемая логика в SoC от AMD (или в устройствах Zynq от Xilinx) предоставляет разработчикам мощный инструмент для оптимизации и специализации обработки данных. Это не только ускоряет выполнение задач, но и повышает общую эффективность системы за счет снижения нагрузки на процессорную систему и улучшения энергоэффективности.

### Процессорные ядра ARM
Процессорные ядра ARM Cortex используются в различных системах-на-кристалле (SoC) от AMD, и каждый тип ядра (Cortex-A, Cortex-R, Cortex-M) оптимизирован для выполнения определённых задач. Давайте более подробно рассмотрим каждый из этих профилей и их особенности.

### Cortex-A Series: Application Profile
Ядра **Cortex-A** предназначены для приложений, требующих высокой производительности. Это наиболее мощные ядра среди семейства ARM и они широко используются в различных устройствах, от смартфонов до серверов.

**Основные характеристики Cortex-A:**
- **Высокая Производительность:** Эти ядра предназначены для выполнения сложных вычислений и обеспечения высокой производительности в многозадачных средах.
- **Многозадачность:** Поддержка полноценной операционной системы с возможностью многозадачной работы, благодаря наличию [MMU (Memory Management Unit)](https://habr.com/ru/articles/211150/). MMU позволяет использовать виртуальную память, защищать память разных процессов и эффективно управлять памятью.
- **Набор Инструкций:** Поддерживает расширенный набор инструкций ARM, включая ARMv7-A, ARMv8-A и более новые. Это включает поддержку 32-бит (A32) и 64-бит (A64) инструкций.
- **Примеры Ядер:** Cortex-A53, Cortex-A57, Cortex-A72, Cortex-A76 и другие. Например, Cortex-A53 является одним из наиболее популярных энергоэффективных ядер, в то время как Cortex-A76 и более новые обеспечивают высокую производительность для интенсивных вычислений.

### Cortex-R Series: Real-Time Profile
Ядра **Cortex-R** оптимизированы для систем реального времени, которые требуют гарантированных времён отклика и высокой надёжности.

**Основные характеристики Cortex-R:**

- **Реальное Время:** Оптимизированы для задач, где важны предсказуемость и низкая задержка. Это критически важно для систем управления, автомобильной электроники и других приложений реального времени.
- **Надёжность и Детерминизм:** Предоставляют функции для обеспечения надёжности и детерминированной работы, включая поддержку технологии ECC (Error-Correcting Code) в памяти (*тип системы коррекции ошибок, используемый в компьютерной памяти, чтобы обнаруживать и исправлять типичные ошибки, которые могут возникнуть в данных во время их записи, хранения, передачи или обработки*).
- **Memory Protection Unit (MPU):** В отличие от MMU, MPU управляет доступом к памяти **без использования виртуальной адресации**, что упрощает архитектуру и снижает задержки.
- **Примеры Ядер:** Cortex-R4, Cortex-R5, Cortex-R7, Cortex-R8. Например, Cortex-R5 используется в автомобильных системах управления, а Cortex-R8 может использоваться в высокопроизводительных модемах.

### Cortex-M Series: Microcontroller Profile
Ядра **Cortex-M** предназначены для микроконтроллеров и простых устройств, где важны компактность, низкое энергопотребление и простота разработки.

**Основные характеристики Cortex-M:**
- **Низкое Энергопотребление:** Оптимизированы для минимизации энергопотребления, что критически важно для портативных устройств и IoT (Internet of Things).
- **Ограниченный Набор Инструкций:** Используют упрощённый набор инструкций, что уменьшает размер ядра и упрощает его интеграцию в маломощные устройства.
- **Программная Совместимость:** Ядра Cortex-M легко программируются и поддерживают множество разработческих инструментов, что делает их популярными среди разработчиков встроенных систем.
- **Примеры Ядер:** Cortex-M0, Cortex-M3, Cortex-M4, Cortex-M7. Например, Cortex-M4 и Cortex-M7 популярны в приложениях, требующих DSP-функций и плавающей запятой.

Примеры использования:
- **Cortex-A** используется в смартфонах, планшетах, мультимедийных устройствах и серверах. Например, многие Android устройства используют SoC на базе Cortex-A.
- **Cortex-R** находит применение в автомобильной промышленности, промышленных контроллерах и системах связи.
- **Cortex-M** широко используется в микроконтроллерах для IoT, носимой электроники и умных датчиков.


Процессорные ядра ARM Cortex в SoC от AMD предоставляют разработчикам мощный инструментарий для создания систем различного уровня сложности и назначения. В зависимости от требований к производительности, энергоэффективности и специфическим задачам, можно выбрать соответствующий тип ядра, оптимально подходящий для конкретного приложения.

## Аппаратные платформы SoC компании AMD.

## Процессорная система AMD SoC Zynq-7000: характеристики, конфигурация.

## Программируемая логика AMD SoC Zynq-7000: характеристики, конфигурация.

## Коммуникация между процессорной системой и программируемой логикой в AMD SoC Zynq-7000. AMD SoC Zynq Ultrascale+: серии, характеристики.

## AMD SoC Versal: серии, характеристики

## Отладочные платы на базе AMD SoC.

## Используемые инструменты для работы с СнК/SoC.

## ECC (⚠ дополнительно)
**ECC (Error-Correcting Code)** — это тип системы коррекции ошибок, используемый в компьютерной памяти, чтобы обнаруживать и исправлять типичные ошибки, которые могут возникнуть в данных во время их записи, хранения, передачи или обработки. Это особенно важно в системах, где требуется высокая надёжность и стабильность, например, в серверах, системах хранения данных и критически важных приложениях.

### Как работает ECC?
1. **Дополнительные Биты:** ECC добавляет дополнительные "проверочные" биты к данным, которые позволяют системе обнаруживать и исправлять ошибки. Например, вместо каждых 8 бит данных может быть добавлено несколько дополнительных битов, образуя код, способный исправлять ошибки.
2. **Обнаружение и Исправление:** Когда данные считываются из памяти, ECC проверяет все биты, включая проверочные, чтобы определить, не произошло ли изменения. Если обнаруживается ошибка, ECC автоматически исправляет исходные данные до передачи их процессору.
3. **Типы Ошибок:** ECC может обнаруживать и исправлять однобитовые ошибки (один бит данных изменён) и обнаруживать (но не всегда исправлять) двухбитовые и многобитовые ошибки.

### Примеры и Применение ECC
- **Серверная Память:** В серверных компьютерах и рабочих станциях часто используется ECC память (ECC RAM), чтобы предотвратить потерю данных и сбои системы, вызванные случайными ошибками в памяти.
- **Системы Хранения:** В системах хранения данных ECC используется для гарантии целостности данных на жёстких дисках, SSD и в RAID-массивах.
- **Космическая Техника:** В условиях космического излучения, где частота ошибок в памяти выше, ECC критически важен для функционирования спутников и другой космической аппаратуры.

### Преимущества и Недостатки ECC
**Преимущества:**
- **Надёжность:** Уменьшает риск некорректной работы программ из-за случайных ошибок в памяти.
- **Стабильность:** Повышает общую стабильность системы, предотвращая сбои и повреждение данных.
- **Автоматическое Исправление:** Может автоматически исправлять типичные однобитовые ошибки, не прерывая работу системы.

**Недостатки:**
- **Стоимость:** ECC память обычно дороже обычной памяти из-за дополнительных битов и сложности контроллеров.
- **Производительность:** Использование ECC может немного снизить производительность из-за дополнительной обработки для проверки и коррекции ошибок.

### Заключение
ECC является важной технологией для увеличения надёжности и стабильности в вычислительных системах, особенно там, где требуется защита от случайных ошибок памяти. Она обеспечивает дополнительную защиту данных и помогает предотвратить потери и сбои, что делает её ценным выбором для многих применений, требующих высокой надёжности.